# Distributed Counter

ì´ ì˜ˆì œëŠ” ê¸°ë³¸ì ì¸ ë¶„ì‚° ì¹´ìš´í„° ì•±ì„ ë§Œë“œëŠ” ê³¼ì •ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.

Sui Move ëª¨ë“ˆì„ ì‘ì„±í•˜ê³  ì´ë¥¼ React ê¸°ë°˜ì˜ Sui dAppê³¼ ì—°ë™í•˜ëŠ” ì „ì²´ ê³¼ì •ì„ ë‹¤ë£¹ë‹ˆë‹¤. ì´ dAppì€ ëˆ„êµ¬ë‚˜ ì¹´ìš´í„°ë¥¼ ìƒì„±í•˜ê³  ê°’ì„ ì¦ê°€ì‹œí‚¬ ìˆ˜ ìˆì§€ë§Œ, ì¹´ìš´í„°ë¥¼ ì´ˆê¸°í™”(ë¦¬ì…‹)í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì€ ì†Œìœ ìì—ê²Œë§Œ ë¶€ì—¬ë©ë‹ˆë‹¤.

**ê°€ì´ë“œëŠ” ë‘ ë¶€ë¶„ìœ¼ë¡œ ë‚˜ë‰©ë‹ˆë‹¤.**

> 1.  ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸: ì¹´ìš´í„° êµ¬ì¡°ì²´ì™€ ë¡œì§ì„ ì„¤ì •í•˜ëŠ” Move ì½”ë“œ
> 2.  í”„ë¡ íŠ¸ì—”ë“œ: ì‚¬ìš©ìê°€ ì¹´ìš´í„° ê°ì²´ë¥¼ ìƒì„±í•˜ê³ , ì¦ê°€ì‹œí‚¤ë©°, ë¦¬ì…‹í•  ìˆ˜ ìˆëŠ” UI

ì´ë²ˆ ê°€ì´ë“œëŠ” `Shared Object`sì— ëŒ€í•´ì„œ ë‹¤ë£¹ë‹ˆë‹¤. SuiëŠ” Object ì¤‘ì‹¬ì˜ Move ì–¸ì–´ë¥¼ ì‚¬ìš©í•˜ë©°, ê°ì²´(Object)ëŠ” í¬ê²Œ `Shared Objects`ì™€ `Owned Objects`ë¡œ ë‚˜ë‰©ë‹ˆë‹¤. <br>

> Shared ObjectsëŠ” ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ë™ì‹œì— ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë©°, ì „ì—­ì ìœ¼ë¡œ ê³µìœ  ê°€ëŠ¥í•œ ê°ì²´
>
> Owned ObjectsëŠ” íŠ¹ì • ê³„ì •ì´ ì†Œìœ í•˜ë©°, ì†Œìœ ìë§Œì´ ì§ì ‘ ì ‘ê·¼í•˜ê³  ë³€ê²½í•  ìˆ˜ ìˆëŠ” ê°ì²´

ì˜ˆë¥¼ ë“¤ì–´ í¬ì»¤ ê²Œì„ì„ ìƒê°í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> Shared Objects: í…Œì´ë¸” ìœ„ì˜ í¬ì»¤ ë±ì²˜ëŸ¼, ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì ‘ê·¼í•˜ê³  ì¹´ë“œë¥¼ ë½‘ì„ ìˆ˜ ìˆëŠ” ê°ì²´
>
> Owned Objects: ê° í”Œë ˆì´ì–´ê°€ ë“¤ê³  ìˆëŠ” ì†íŒ¨ì²˜ëŸ¼, ì˜¤ì§ í•´ë‹¹ í”Œë ˆì´ì–´ë§Œ ì ‘ê·¼í•˜ê³  ë³¼ ìˆ˜ ìˆëŠ” ê°ì²´

 <br>
ì´ë²ˆ Distributed Counterì—ì„œëŠ” Shared Objectsë¥¼ ì‚¬ìš©í•˜ì—¬ ì „ì—­ì ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•œ ì¹´ìš´í„° ê°ì²´(Counter objects)ë¥¼ ìƒì„±í•˜ê³ , ëˆ„êµ¬ë‚˜ ì¦ê°€ì‹œí‚¬ ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•©ë‹ˆë‹¤.

## 1ë‹¨ê³„: í”„ë¡œì íŠ¸ í´ë” ìƒì„±

ìƒˆë¡œìš´ í´ë”ë¥¼ ìƒì„±í•˜ì—¬ ì´ë™í•©ë‹ˆë‹¤.

```bash
mkdir distributed-counter && cd distributed-counter
```

ì´ í´ë”ëŠ” í”„ë¡œì íŠ¸ì˜ ëª¨ë“  íŒŒì¼ì„ ë‹´ëŠ” ìµœìƒìœ„ í´ë”ì…ë‹ˆë‹¤.
ì›í•˜ëŠ” ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ë°”ê¿”ë„ ë˜ì§€ë§Œ, ì´í›„ ê°€ì´ë“œì—ì„œëŠ” ì´ êµ¬ì¡°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.

## 2ë‹¨ê³„: Move ë””ë ‰í† ë¦¬ ìƒì„±

```bash
mkdir -p ./move/counter/sources
```

`sources` í´ë”ì— move ì½”ë“œê°€ ì‘ì„±ë  ê²ƒì…ë‹ˆë‹¤.

## 3ë‹¨ê³„: Smart Contracts ì‘ì„±

### 3-1: toml íŒŒì¼ ì‘ì„±

ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ë¥¼ ì‘ì„±í•˜ê¸° ì‹œì‘í•˜ë ¤ë©´, `distributed-counter/move/counter` ì•ˆì— `Move.toml` íŒŒì¼ì„ ìƒì„±í•˜ê³ , ë‹¤ìŒ ì½”ë“œë¥¼ ë³µì‚¬í•˜ì—¬ ë¶™ì—¬ë„£ìŠµë‹ˆë‹¤.

```bash
[package]
name = "counter"
version = "0.0.1"
edition = "2024.beta"

[dependencies]
Sui = { git = "https://github.com/MystenLabs/sui.git", subdir = "crates/sui-framework/packages/sui-framework", rev = "framework/testnet" }

[addresses]
counter = "0x0"
```

`Move.toml`ì€ Move íŒ¨í‚¤ì§€ì˜ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ë¡œ, Move ëª¨ë“ˆì„ êµ¬ì„±í•˜ê³  ê´€ë¦¬í•˜ëŠ” ì •ë³´ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.

### 1. [package]

íŒ¨í‚¤ì§€ ìì²´ì˜ ê¸°ë³¸ ì •ë³´ë¥¼ ì •ì˜í•˜ëŠ” í•„ë“œì…ë‹ˆë‹¤.

| í•„ë“œ      | ì„¤ëª…                         | ì˜ˆì‹œ ê°’       |
| --------- | ---------------------------- | ------------- |
| `name`    | íŒ¨í‚¤ì§€ ì´ë¦„                  | `"counter"`   |
| `version` | íŒ¨í‚¤ì§€ ë²„ì „                  | `"0.0.1"`     |
| `edition` | Move ì–¸ì–´ ë²„ì „/íŒ¨í‚¤ì§€ ì—ë””ì…˜ | `"2024.beta"` |

> ğŸ’¡ **ê°„ë‹¨ ì„¤ëª…**: ì´ íŒ¨í‚¤ì§€ê°€ ì–´ë–¤ ì´ë¦„ê³¼ ë²„ì „ìœ¼ë¡œ ì¡´ì¬í•˜ëŠ”ì§€, ì–´ë–¤ Move ì—ë””ì…˜ì„ ì‚¬ìš©í•˜ëŠ”ì§€ ì•Œë ¤ì£¼ëŠ” ì„¤ì •ì…ë‹ˆë‹¤.

### 2. [dependencies]

íŒ¨í‚¤ì§€ê°€ ì˜ì¡´í•˜ëŠ” ë‹¤ë¥¸ Move íŒ¨í‚¤ì§€ë‚˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„ ì–¸í•˜ëŠ” í•„ë“œì…ë‹ˆë‹¤. ì˜ˆì œì—ì„œëŠ” Sui íŒ¨í‚¤ì§€ë¥¼ Git ë¦¬í¬ì§€í† ë¦¬ì—ì„œ ê°€ì ¸ì˜¤ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.

| í•„ë“œ     | ì„¤ëª…                             | ì˜ˆì‹œ ê°’                                         |
| -------- | -------------------------------- | ----------------------------------------------- |
| `git`    | íŒ¨í‚¤ì§€ Git URL                   | `"https://github.com/MystenLabs/sui.git"`       |
| `subdir` | í•´ë‹¹ ë¦¬í¬ì§€í† ë¦¬ ë‚´ì˜ íŒ¨í‚¤ì§€ ê²½ë¡œ | `"crates/sui-framework/packages/sui-framework"` |
| `rev`    | ì‚¬ìš©í•  ë¸Œëœì¹˜ë‚˜ ì»¤ë°‹             | `"framework/testnet"`                           |

> ğŸ’¡ **ê°„ë‹¨ ì„¤ëª…**: ë‚´ íŒ¨í‚¤ì§€ê°€ ë‹¤ë¥¸ íŒ¨í‚¤ì§€(Sui í”„ë ˆì„ì›Œí¬)ë¥¼ í•„ìš”ë¡œ í•œë‹¤ê³  ì•Œë ¤ì£¼ëŠ” ì„¤ì •ì…ë‹ˆë‹¤. `Distributed Counter`ì—ì„œëŠ” `transfer::share_object`ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ Sui í”„ë ˆì„ì›Œí¬ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

### 3. [addresses]

Move íŒ¨í‚¤ì§€ì—ì„œ ì‚¬ìš©í•  ì „ì—­ ì£¼ì†Œ(Address) ë§¤í•‘ì„ ì •ì˜í•˜ëŠ” í•„ë“œì…ë‹ˆë‹¤.

| ì„¤ì •              | ì„¤ëª…                              |
| ----------------- | --------------------------------- |
| `counter = "0x0"` | counter ëª¨ë“ˆì´ ë°°í¬ë  ì£¼ì†Œë¥¼ ì§€ì • |

> ğŸ’¡ **ê°„ë‹¨ ì„¤ëª…**: Move ëª¨ë“ˆì—ì„œ ì£¼ì†Œë¥¼ í•˜ë“œì½”ë”©í•˜ì§€ ì•Šê³ , ì´ë¦„ìœ¼ë¡œ ì°¸ì¡°í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

### 3-2 `counter.move` íŒŒì¼ ìƒì„± ë° `module` ì •ì˜

distributed-counter/move/counter/sources ì•ˆì— `counter.move` íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.
íŒŒì¼ ì•ˆì— ì•„ë˜ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

```rust
module counter::counter;
```

`counter::counterëŠ”` íŒ¨í‚¤ì§€ ì´ë¦„(counter)ê³¼ ëª¨ë“ˆ ì´ë¦„(counter)ì„ `::`ë¡œ êµ¬ë¶„í•œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì…ë‹ˆë‹¤.

- ì²« ë²ˆì§¸ counter: íŒ¨í‚¤ì§€ ì´ë¦„ (Move.tomlì˜ `[package] name = "counter"`)

- ë‘ ë²ˆì§¸ counter: ëª¨ë“ˆ ì´ë¦„, ì´ ì•ˆì— ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ë¡œì§ì„ ì‘ì„±

ì¦‰, â€œì´ íŒ¨í‚¤ì§€ ì•ˆì— counterë¼ëŠ” ëª¨ë“ˆì„ ë§Œë“¤ê² ë‹¤â€ë¼ëŠ” ì„ ì–¸ì…ë‹ˆë‹¤.

> íŒ¨í‚¤ì§€(Package) <br>
> íŒ¨í‚¤ì§€ = Move ëª¨ë“ˆë“¤ì˜ ë¬¶ìŒ + ë©”íƒ€ë°ì´í„°
>
> Move.toml íŒŒì¼ë¡œ ì •ì˜í•˜ë©°, í•˜ë‚˜ì˜ íŒ¨í‚¤ì§€ ì•ˆì—ëŠ” ì—¬ëŸ¬ ëª¨ë“ˆì„ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
>
> íŒ¨í‚¤ì§€ëŠ” ë°°í¬ ë‹¨ìœ„ì…ë‹ˆë‹¤. ë¸”ë¡ì²´ì¸ì— ë°°í¬í•  ë•Œ íŒ¨í‚¤ì§€ ë‹¨ìœ„ë¡œ ë¹Œë“œ ë° ë°°í¬í•©ë‹ˆë‹¤.

> ëª¨ë“ˆ(Module) <br>
> ëª¨ë“ˆ = ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ë˜ëŠ” ê¸°ëŠ¥ ë‹¨ìœ„ ì½”ë“œ
>
> íŒ¨í‚¤ì§€ ì•ˆì—ì„œ ì •ì˜í•˜ë©°, structì™€ í•¨ìˆ˜ë“¤ì„ í¬í•¨í•©ë‹ˆë‹¤.
>
> ëª¨ë“ˆ ì•ˆì—ì„œ ì •ì˜í•œ í•¨ìˆ˜ì™€ êµ¬ì¡°ì²´ëŠ” ë‹¤ë¥¸ ëª¨ë“ˆì´ë‚˜ ì™¸ë¶€ì—ì„œ ë¶ˆëŸ¬ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 3-3 `Counter` struct ìƒì„±

```rust
public struct Counter has key {
  id: UID,
  owner: address,
  value: u64
}
```

`Counter` íƒ€ì…ì€ ê·¸ ì†Œìœ ìì˜ ì£¼ì†Œ(`owner`), í˜„ì¬ ìƒíƒœ(`value`), ê·¸ë¦¬ê³  ìì‹ ì˜ ì•„ì´ë””(`id`)ì„ ì €ì¥í•©ë‹ˆë‹¤.

### Suiì˜ ê°ì²´ì—ì„œì˜`has key`ì™€ `id`

> - `has key`: ì´ êµ¬ì¡°ì²´ëŠ” ë¸”ë¡ì²´ì¸ì—ì„œ ê³ ìœ í•˜ê²Œ ì‹ë³„ ê°€ëŠ¥í•œ ê°ì²´ì„ì„ ì˜ë¯¸
>
> - `id`: `UID`: ê°ì²´ë§ˆë‹¤ ì¤‘ë³µ ì—†ëŠ” ê³ ìœ  IDë¥¼ ê°€ì§€ê³  ìˆìŒ â†’ ë¸”ë¡ì²´ì¸ì´ ê°ì²´ë¥¼ ì¶”ì  ê°€ëŠ¥

Moveì—ì„œëŠ” ëª¨ë“  ìì‚°ê³¼ ë°ì´í„°ê°€ ê°ì²´(Object) ë‹¨ìœ„ë¡œ ì†Œìœ ê¶Œê³¼ ìƒíƒœë¥¼ ëª…í™•íˆ ê´€ë¦¬ë˜ë„ë¡ ì„¤ê³„ë˜ì–´ ìˆìŠµë‹ˆë‹¤. Suiì—ì„œ ê°ì²´ëŠ” `has key`ì™€ `UID` ë•ë¶„ì— ë¸”ë¡ì²´ì¸ ìƒì—ì„œ ëˆ„ê°€ ì†Œìœ í•˜ê³  ìˆëŠ”ì§€, ê·¸ë¦¬ê³  í˜„ì¬ ê°’ì´ ë¬´ì—‡ì¸ì§€ ì •í™•íˆ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì†Œìœ ì ê¶Œí•œ ê´€ë¦¬, ìƒíƒœ ì¶”ì , ë™ì‹œì„± ì²˜ë¦¬, ë°ì´í„° ì¼ê´€ì„±ì„ ë³´ì¥í•˜ëŠ” ë° í•„ìˆ˜ì ì…ë‹ˆë‹¤.

### 3-4 `Counter`ì˜ ë¡œì§ ì‘ì„±

```rust
public fun create(ctx: &mut TxContext) {
  transfer::share_object(Counter {
    id: object::new(ctx),
    owner: ctx.sender(),
    value: 0
  })
}

public fun increment(counter: &mut Counter) {
  counter.value = counter.value + 1;
}

public fun set_value(counter: &mut Counter, value: u64, ctx: &TxContext) {
  assert!(counter.owner == ctx.sender(), 0);
  counter.value = value;
}
```

> `public`: ë‹¤ë¥¸ ëª¨ë“ˆì´ë‚˜ ì‚¬ìš©ìê°€ í˜¸ì¶œ ê°€ëŠ¥
>
> `&mut`: ì›ë³¸ì„ ê·¸ëŒ€ë¡œ ë¹Œë ¤ì„œ ì½ê³  ì“¸ ìˆ˜ ìˆëŠ” ì°¸ì¡°ë¡œ, í•¨ìˆ˜ ì•ˆì—ì„œ ê°’ì„ ì§ì ‘ ìˆ˜ì •í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤. ì¦‰, ê°ì²´ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ìƒíƒœë¥¼ ë°”ê¿€ ë•Œ ì“°ë©´ ë©ë‹ˆë‹¤.

### `Create`í•¨ìˆ˜

```rust
public fun create(ctx: &mut TxContext)

```

**`ctx: &mut TxContext`: íŠ¸ëœì­ì…˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ ë°›ì•„ì˜µë‹ˆë‹¤**

- Move/Suiì—ì„œëŠ” íŠ¸ëœì­ì…˜ì´ ëˆ„ê°€ ë³´ëƒˆëŠ”ì§€, ì–´ë–¤ ìì›ì´ ì‚¬ìš©ë˜ëŠ”ì§€ë¥¼ TxContextê°€ ê´€ë¦¬í•©ë‹ˆë‹¤.
- `&mut` â†’ í•¨ìˆ˜ ì•ˆì—ì„œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì˜ˆ: ìƒˆ ê°ì²´ ìƒì„±)

```rust
transfer::share_object(Counter { ... })
```

**`share_object` â†’ Shared Objectë¡œ ë“±ë¡í•©ë‹ˆë‹¤.**

- Shared ObjectëŠ” ëª¨ë“  ì‚¬ëŒì´ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.
- Distributed Counterì—ì„œëŠ” ì—¬ëŸ¬ ì‚¬ìš©ìê°€ increment ê°€ëŠ¥í•˜ê²Œ ë§Œë“œëŠ” í•µì‹¬ì…ë‹ˆë‹¤.

```rust
Counter {
    id: object::new(ctx),
    owner: ctx.sender(),
    value: 0
  }
```

**`object::new(ctx)` â†’ ìƒˆ UIDë¥¼ ìƒì„±í•©ë‹ˆë‹¤.**

- Suiì—ì„œ `has key` ê°ì²´ë¥¼ ë§Œë“¤ ë•Œ ê³ ìœ  IDë¥¼ ë§Œë“¤ì–´ì„œ ë¸”ë¡ì²´ì¸ì— ë“±ë¡í•©ë‹ˆë‹¤.

**`ctx.sender()` â†’ ì´ íŠ¸ëœì­ì…˜ì„ ì‹¤í–‰í•œ ë³´ë‚¸ ì‚¬ëŒì˜ ì£¼ì†Œ**

- `Counter` ê°ì²´ë¥¼ ëˆ„ê°€ ì†Œìœ í•˜ëŠ”ì§€ `owner`ë¡œ ì§€ì •í•©ë‹ˆë‹¤.

**`value: 0`**

- `Counter`ì˜ ì´ˆê¸° ìƒíƒœ ê°’ì„ 0ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

### `increment` í•¨ìˆ˜

```rust
public fun increment(counter: &mut Counter)
```

**`counter: &mut Counter`: Counter ê°ì²´ë¥¼ ì§ì ‘ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ì°¸ì¡°ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.**

- Moveì—ì„œëŠ” ê°’ì„ ë³µì‚¬í•˜ì§€ ì•Šê³  ì›ë³¸ì„ ìˆ˜ì •í•˜ë¯€ë¡œ, í•¨ìˆ˜ì—ì„œ ê°ì²´ë¥¼ ë°”ê¾¸ë©´ ì‹¤ì œ ë¸”ë¡ì²´ì¸ ìƒì˜ ìƒíƒœê°€ ë°”ë¡œ ë³€ê²½ë©ë‹ˆë‹¤.

```rust
counter.value = counter.value + 1;
```

**`Counter` ê°ì²´ ì•ˆì˜ í˜„ì¬ ê°’ì„ `1` ì¦ê°€ì‹œí‚µë‹ˆë‹¤.**

### `set_value` í•¨ìˆ˜

```rust
public fun set_value(counter: &mut Counter, value: u64, ctx: &TxContext)
```

**`counter: &mut Counter`: Counter ê°ì²´ì˜ ì›ë³¸ì„ ì§ì ‘ ìˆ˜ì •í•©ë‹ˆë‹¤.**

**`ctx: &TxContext`: íŠ¸ëœì­ì…˜ ì •ë³´ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤. (ëˆ„ê°€ í˜¸ì¶œí–ˆëŠ”ì§€ í™•ì¸ ê°€ëŠ¥)**

```rust
assert!(counter.owner == ctx.sender(), 0);
```

**`counter.owner == ctx.sender()` â†’ ì´ Counterë¥¼ ë§Œë“  ì‚¬ëŒê³¼ í˜¸ì¶œìê°€ ê°™ì€ì§€ í™•ì¸í•©ë‹ˆë‹¤.**

- `assert!` â†’ ë’¤ì˜ ì¡°ê±´ì´ ì°¸ì´ ì•„ë‹ˆë©´ íŠ¸ëœì­ì…˜ ì‹¤íŒ¨í•©ë‹ˆë‹¤.
- `0` â†’ ì‹¤íŒ¨ ì‹œ ë°˜í™˜í•  ì—ëŸ¬ ì½”ë“œì…ë‹ˆë‹¤.

> ì¦‰, Counterì˜ ê°’ì€ ì†Œìœ ìë§Œ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```rust
counter.value = value;
```

**ì „ë‹¬ë°›ì€ `value`ë¡œ Counter ê°’ì„ ì§ì ‘ ë³€ê²½í•©ë‹ˆë‹¤.**

### 3-5 ì „ì²´ ì½”ë“œ

ìµœì¢… `module`ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```rust
module counter::counter;

public struct Counter has key {
    id: UID,
    owner: address,
    value: u64
}

public fun create(ctx: &mut TxContext) {
    transfer::share_object(Counter {
        id: object::new(ctx),
        owner: ctx.sender(),
        value: 0
    })
}

public fun increment(counter: &mut Counter) {
    counter.value = counter.value + 1;
}

public fun set_value(counter: &mut Counter, value: u64, ctx: &TxContext) {
    assert!(counter.owner == ctx.sender(), 0);
    counter.value = value;
}
```

## 4ë‹¨ê³„ Package ë°°í¬

### 4-1 Sui Client CLI ì„¤ì¹˜ í™•ì¸

Packageë¥¼ ë°°í¬í•˜ê¸° ì „ì—, Sui Client CLIë¥¼ ì„¤ì •ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. í„°ë¯¸ë„ì„ ì—´ê³  ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì„¸ìš”:

```bash
sui client
```

**ë§Œì•½ ë‹¤ìŒê³¼ ê°™ì€ ì‘ë‹µì„ ë°›ìœ¼ë©´, 1.sui-cli-installation.mdë¥¼ ì°¸ê³ í•´ì„œ Sui Client CLIë¥¼ ì„¤ì •í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.**

```bash
Config file ["<FILE-PATH>/.sui/sui_config/client.yaml"] doesn't exist, do you want to connect to a Sui full node server [y/N]?
```

### 4-2 network `testnet`ìœ¼ë¡œ ì„¤ì •

**ì˜ˆì œì—ì„œëŠ” `testnet`ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.**

```bash
sui client switch --env testnet
```

### 4-3 ê°€ìŠ¤ë¹„ë¡œ ì‚¬ìš©ë  sui í† í° ë°›ê¸°

**ë°°í¬ë¥¼ í•˜ê¸° ìœ„í•´ì„œëŠ” ê°€ìŠ¤ë¹„ë¡œ ì‚¬ìš©í•  Testnet Sui í† í°ì´ í•„ìš”í•©ë‹ˆë‹¤.**

**ë¨¼ì € sui clientì— ì‚¬ìš©ë˜ëŠ” ê³„ì •ì˜ ì£¼ì†Œë¥¼ í™•ì¸í•©ë‹ˆë‹¤.**

```bash
sui client active-address
```

ìœ„ì˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ ì¶œë ¥ëœ ê°’ì´ í˜„ì¬ client ì‚¬ìš©ìì˜ ì£¼ì†Œì…ë‹ˆë‹¤.

ì•„ë˜ Sui faucet ì‚¬ì´íŠ¸ì— ë°©ë¬¸í•˜ì—¬ ê³„ì • ì£¼ì†Œë¥¼ ì…ë ¥í•˜ê³  `Request Testnet SUI` ë²„íŠ¼ì„ ëˆ„ë¦…ë‹ˆë‹¤.

```plain text
https://faucet.sui.io/
```

ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ `balance`ê°€ ì¦ê°€í•œ ê²ƒì„ í™•ì¸í•©ë‹ˆë‹¤.

```bash
sui client balance
```

### 4-4 Package ë°°í¬

gitì„ ì‚¬ìš©í•  ê²½ìš° root ë””ë ‰í† ë¦¬ì— `.gitignore` íŒŒì¼ì„ ìƒì„±í›„ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•©ë‹ˆë‹¤.

```plain text
move/counter/build/
```

ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ í„°ë¯¸ë„ì— ì…ë ¥í•˜ì—¬ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”. ì´ë•Œ ëª…ë ¹ì–´ëŠ” `Move.toml`íŒŒì¼ì´ ìˆëŠ” ê°™ì€ ë””ë ‰í† ë¦¬(`move/counter`)ì—ì„œ ì‹¤í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

```bash
sui client publish --gas-budget 20000000
```

> `Request rejected 429` ì—ëŸ¬ëŠ” `Too Many Requests.` ì—ëŸ¬ë¡œ ë°œìƒì‹œ ë°°í¬ ëª…ë ¹ì„ ë‹¤ì‹œ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤. ë°°í¬ê°€ ê³„ì† ì•ˆë  ê²½ìš° `RPC URL`ì„ ë°”ê¿”ì¤˜ì•¼ í•©ë‹ˆë‹¤.
> ê°€ìŠ¤ë¹„ê°€ ë„ˆë¬´ ë†’ì„ ê²½ìš° `--gas-budget 20000000`ì„ ì‚­ì œí•´ë´…ë‹ˆë‹¤.

ì´ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ `packageID` ê°’ì´ ì¶œë ¥ë˜ë©°, ì´í›„ì— packageë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë°˜ë“œì‹œ ì´ ê°’ì„ ì €ì¥í•´ ë‘ì–´ì•¼ í•©ë‹ˆë‹¤.

```bash
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ Object Changes                                                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Created Objects:                                                                                 â”‚
â”‚  â”Œâ”€â”€                                                                                             â”‚
â”‚  â”‚ ObjectID: 0x5f460935265e2c7727a72db1dc2b9ac0b83b1554f6115ce0d411af1de6647aa6                  â”‚
â”‚  â”‚ Sender: 0xd43008f2255d346b29a5a87b64a8f991373684a4cd73fe2ad57c31584bf68a0b                    â”‚
â”‚  â”‚ Owner: Account Address ( 0xd43008f2255d346b29a5a87b64a8f991373684a4cd73fe2ad57c31584bf68a0b ) â”‚
â”‚  â”‚ ObjectType: 0x2::package::UpgradeCap                                                          â”‚
â”‚  â”‚ Version: 349167823                                                                            â”‚
â”‚  â”‚ Digest: 8PC3Nay25qXP9icSK6sBLRxQZ7PGNYBZCMBY9Zj1WqLZ                                          â”‚
â”‚  â””â”€â”€                                                                                             â”‚
â”‚ Mutated Objects:                                                                                 â”‚
â”‚  â”Œâ”€â”€                                                                                             â”‚
â”‚  â”‚ ObjectID: 0xb57fb3a51ba2fc5d8eab8708779362eb49f54a6ceb7f0b4848e80c2062702afa                  â”‚
â”‚  â”‚ Sender: 0xd43008f2255d346b29a5a87b64a8f991373684a4cd73fe2ad57c31584bf68a0b                    â”‚
â”‚  â”‚ Owner: Account Address ( 0xd43008f2255d346b29a5a87b64a8f991373684a4cd73fe2ad57c31584bf68a0b ) â”‚
â”‚  â”‚ ObjectType: 0x2::coin::Coin<0x2::sui::SUI>                                                    â”‚
â”‚  â”‚ Version: 349167823                                                                            â”‚
â”‚  â”‚ Digest: FGzs8gSsEGdhzsiNRb5Absf9u71coubptSGpsQUGgMh1                                          â”‚
â”‚  â””â”€â”€                                                                                             â”‚
â”‚ Published Objects:                                                                               â”‚
â”‚  â”Œâ”€â”€                                                                                             â”‚
â”‚  â”‚ PackageID: 0xad6ef04f3fcca07008be1bcc26a718c674d1ad494ef35ff3d2d20f4a9ecdab8e                 â”‚
â”‚  â”‚ Version: 1                                                                                    â”‚
â”‚  â”‚ Digest: 4r8tVf5a9StT28dxaQZty8u8Gxw4SP1DqVUvkQeg8Xto                                          â”‚
â”‚  â”‚ Modules: counter                                                                              â”‚
â”‚  â””â”€â”€                                                                                             â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

ë°°í¬ í›„ í„°ë¯¸ë„ì˜ Object Changesì—ëŠ” 3ê°œì˜ Objectì— ëŒ€í•œ íŠ¸ëœì­ì…˜ ê²°ê³¼ ìš”ì•½ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.

- `Created Objects` â†’ ìƒˆë¡œ ë§Œë“¤ì–´ì§„ ê°ì²´ (ì˜ˆ: UpgradeCap)
- `Mutated Objects` â†’ ê¸°ì¡´ ê°ì²´ê°€ ìˆ˜ì •ë¨ (ì˜ˆ: Sui ì½”ì¸ ìˆ˜ëŸ‰ ë³€ê²½)
- `Published Objects` â†’ Move íŒ¨í‚¤ì§€ ìì²´ê°€ ë°°í¬ë¨
  <br><br>

1. `Created Objects`
   - `UpgradeCap` ê°ì²´ê°€ ìƒì„±
   - `UpgradeCap`ì€ â€œì´ íŒ¨í‚¤ì§€ë¥¼ ì—…ê·¸ë ˆì´ë“œí•  ìˆ˜ ìˆëŠ” ê¶Œí•œ ì¦ëª…ì„œâ€
   - ì¦‰, UpgradeCapì„ ê°€ì§„ ê³„ì •ë§Œ íŒ¨í‚¤ì§€ë¥¼ ì¬ë°°í¬í•˜ê±°ë‚˜ ì—…ê·¸ë ˆì´ë“œê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
2. `Mutated Objects`
   - Mutated ObjectsëŠ” ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê°ì²´ê°€ ë³€ê²½ëœ ê²½ìš° í‘œì‹œë˜ë©°, ì˜ˆì‹œì—ì„œëŠ” Sui ì½”ì¸ ê°ì²´ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.
   - ì¦‰, ì˜ˆì œì—ì„œëŠ” Sui ì½”ì¸ ìˆ˜ëŸ‰ì˜ ì¦ê°€/ê°ì†Œ, ê±°ë˜ ë“±ì˜ ê²°ê³¼ê°€ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.
3. `Published Objects`
   - ë°°í¬ëœ `Counter Package`ì˜ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
   - í”„ë¡ íŠ¸ì—”ë“œì™€ì˜ ì—°ê²°ì„ ìœ„í•´ Packageì˜ ê³ ìœ  ì•„ì´ë””ì¸ `PackageID`ë¥¼ ë”°ë¡œ ì €ì¥í•´ë‘¡ë‹ˆë‹¤.
     <br><br>

**`Object Changes`ì˜ ìš”ì†Œë“¤**

- `ObjectID`: Sui ë¸”ë¡ì²´ì¸ ìƒì—ì„œ ì´ ê°ì²´ì˜ ê³ ìœ  ì‹ë³„ì.
- `Sender`: ì´ ê°ì²´ë¥¼ ìƒì„±í•œ ê³„ì • ì£¼ì†Œ.
- `Owner`: ê°ì²´ë¥¼ ì†Œìœ í•˜ëŠ” ê³„ì •(ê¶Œí•œ ìˆëŠ” ê³„ì •). ë³´í†µ Senderì™€ ë™ì¼.
- `ObjectType`: ê°ì²´ì˜ íƒ€ì…
- `Version`: ê°ì²´ì˜ ë²„ì „, ê°ì²´ê°€ ìˆ˜ì •ë  ë•Œë§ˆë‹¤ ì¦ê°€.
- `Digest`: ê°ì²´ ë‚´ìš©ì˜ í•´ì‹œê°’, ë¬´ê²°ì„± í™•ì¸ìš©.

## 5ë‹¨ê³„ í”„ë¡ íŠ¸ì—”ë“œ ìƒì„±

### 5-1 í”„ë¡ íŠ¸ì—”ë“œ scaffold ìƒì„±

ì•„ë˜ëŠ” Sui Dappì„ ìƒì„±í•˜ê¸° ìœ„í•œ ê¸°ë³¸ í‹€ì„ ì œê³µí•´ì£¼ëŠ” Scaffoldë¥¼ ìƒì„±í•˜ëŠ” ëª…ë ¹ì–´ì…ë‹ˆë‹¤. `move` í´ë”ì™€ ê°™ì€ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— ìƒì„±í•´ì¤ë‹ˆë‹¤.

```bash
pnpm create @mysten/dapp --template react-client-dapp
```

Sui ê³µì‹ dApp í…œí”Œë¦¿ íŒ¨í‚¤ì§€(@mysten/dapp)ë¥¼ ì‹¤í–‰í•˜ê³ , ê·¸ ì•ˆì—ì„œ react-client-dapp í…œí”Œë¦¿ìœ¼ë¡œ ìƒˆë¡œìš´ dApp í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì´ íƒ¬í”Œë¦¿ì„ ì˜ˆì œì˜ Scaffoldë¡œ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤. dAppì˜ ì´ë¦„ì„ `counter-dapp`ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

### 5-2 í•„ìš”í•œ dependencies ì„¤ì¹˜

gitì„ ì‚¬ìš©í•  ê²½ìš° `.gitignore` íŒŒì¼ì— ë‹¤ìŒì„ ì¶”ê°€í•©ë‹ˆë‹¤.

```plain text
node_modules/
```

ì´ ì•±ì€ ì•„ì´ì½˜ í‘œì‹œë¥¼ ìœ„í•´ `react-spinners` íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. (`counter-dapp` í´ë”ë¡œ ì´ë™ í›„ ì„¤ì¹˜í•©ë‹ˆë‹¤.)

```bash
pnpm add react-spinners
```

### 5-3 `src/constants.ts` íŒŒì¼ ìƒì„±

`src` í´ë”ì— `constants.ts` íŒŒì¼ì„ ìƒì„±í›„ ì•„ë˜ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

```typescript
export const DEVNET_COUNTER_PACKAGE_ID = "0xTODO";
export const TESTNET_COUNTER_PACKAGE_ID = <YOUR_PACKAGE_ADDRESS>;
export const MAINNET_COUNTER_PACKAGE_ID = "0xTODO";
```

`<YOUR_PACKAGE_ADDRESS>`ì— 4-4ì— ì €ì¥í•œ `packageID`ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.

### 5-4 `src/networkConfig.ts` íŒŒì¼ ì—…ë°ì´íŠ¸

`src/networkConfig.ts` íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

```typescript
import { getFullnodeUrl } from "@mysten/sui/client";
import {
  DEVNET_COUNTER_PACKAGE_ID,
  TESTNET_COUNTER_PACKAGE_ID,
  MAINNET_COUNTER_PACKAGE_ID,
} from "./constants.ts";
import { createNetworkConfig } from "@mysten/dapp-kit";

const { networkConfig, useNetworkVariable, useNetworkVariables } =
  createNetworkConfig({
    devnet: {
      url: getFullnodeUrl("devnet"),
      variables: {
        counterPackageId: DEVNET_COUNTER_PACKAGE_ID,
      },
    },
    testnet: {
      url: getFullnodeUrl("testnet"),
      variables: {
        counterPackageId: TESTNET_COUNTER_PACKAGE_ID,
      },
    },
    mainnet: {
      url: getFullnodeUrl("mainnet"),
      variables: {
        counterPackageId: MAINNET_COUNTER_PACKAGE_ID,
      },
    },
  });

export { useNetworkVariable, useNetworkVariables, networkConfig };
```

`variables`ë¥¼ í†µí•´ `counter`ì˜ `PackageId`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 5-5 `src/CreateCounter.tsx` íŒŒì¼ ìƒì„±

`src` í´ë”ì— `CreateCounter.tsx` íŒŒì¼ì„ ìƒì„±í•˜ê³  ì•„ë˜ì™€ ê°™ì´ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

```typescript
import { Transaction } from "@mysten/sui/transactions";
import { Button, Container } from "@radix-ui/themes";
import { useSignAndExecuteTransaction, useSuiClient } from "@mysten/dapp-kit";
import { useNetworkVariable } from "./networkConfig";
import ClipLoader from "react-spinners/ClipLoader";

export function CreateCounter({
  onCreated,
}: {
  onCreated: (id: string) => void;
}) {
  const counterPackageId = useNetworkVariable("counterPackageId");
  const suiClient = useSuiClient();
  const {
    mutate: signAndExecute,
    isSuccess,
    isPending,
  } = useSignAndExecuteTransaction();

  function create() {
    const tx = new Transaction();

    tx.moveCall({
      arguments: [],
      target: `${counterPackageId}::counter::create`,
    });

    signAndExecute(
      {
        transaction: tx,
      },
      {
        onSuccess: async ({ digest }) => {
          const { effects } = await suiClient.waitForTransaction({
            digest: digest,
            options: {
              showEffects: true,
            },
          });

          onCreated(effects?.created?.[0]?.reference?.objectId!);
        },
      }
    );
  }

  return (
    <Container>
      <Button
        size="3"
        onClick={() => {
          create();
        }}
        disabled={isSuccess || isPending}
      >
        {isSuccess || isPending ? <ClipLoader size={20} /> : "Create Counter"}
      </Button>
    </Container>
  );
}
```

### 1. íŠ¸ëœì­ì…˜ ìƒì„±

```typescript
const tx = new Transaction();

tx.moveCall({
  arguments: [],
  target: `${counterPackageId}::counter::create`,
});
```

- ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ ê°ì²´ tx ìƒì„±í•©ë‹ˆë‹¤.
- Move ëª¨ë“ˆ í˜¸ì¶œ(moveCall)í•©ë‹ˆë‹¤.
  - í˜¸ì¶œ ëŒ€ìƒ: counterPackageId íŒ¨í‚¤ì§€ ì•ˆì˜ counter ëª¨ë“ˆì˜ create í•¨ìˆ˜
  - ì¸ì: ì—†ìŒ (arguments: [])

### 2. íŠ¸ëœì­ì…˜ ì„œëª… ë° ì‹¤í–‰

```typescript
signAndExecute({ transaction: tx }, { ... });
```

- í˜„ì¬ ì—°ê²°ëœ ì§€ê°‘/í´ë¼ì´ì–¸íŠ¸ë¡œ íŠ¸ëœì­ì…˜ ì„œëª… í›„ ì‹¤í–‰í•©ë‹ˆë‹¤.
- ì½œë°± ì œê³µ (onSuccess) â†’ íŠ¸ëœì­ì…˜ì´ ì„±ê³µí•˜ë©´ í›„ì† ì²˜ë¦¬í•©ë‹ˆë‹¤.

### 3. íŠ¸ëœì­ì…˜ ê²°ê³¼ í™•ì¸ ë° ê°ì²´ ID ë°˜í™˜

```typescript
const { effects } = await suiClient.waitForTransaction({
  digest,
  options: { showEffects: true },
});

onCreated(effects?.created?.[0]?.reference?.objectId!);
```

- íŠ¸ëœì­ì…˜ì´ ë¸”ë¡ì²´ì¸ì—ì„œ ì²˜ë¦¬ë  ë•Œê¹Œì§€ ëŒ€ê¸°í•©ë‹ˆë‹¤.(`waitForTransaction`)
- ì„±ê³µì ìœ¼ë¡œ ê°ì²´ê°€ ìƒì„±ë˜ë©´, ìƒì„±ëœ ì¹´ìš´í„° ê°ì²´ì˜ ObjectIDë¥¼ ì¶”ì¶œí•˜ì—¬ `onCreated` ì½œë°±ìœ¼ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.

### 5-6 `src/Counter.tsx` íŒŒì¼ ìƒì„±

`src` í´ë”ì— `src/Counter.tsx` íŒŒì¼ì„ ìƒì„±í•˜ê³  ì•„ë˜ì™€ ê°™ì´ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

```typescript
import {
  useCurrentAccount,
  useSignAndExecuteTransaction,
  useSuiClient,
  useSuiClientQuery,
} from "@mysten/dapp-kit";
import type { SuiObjectData } from "@mysten/sui/client";
import { Transaction } from "@mysten/sui/transactions";
import { Button, Flex, Heading, Text } from "@radix-ui/themes";
import { useNetworkVariable } from "./networkConfig";
import { useState } from "react";
import ClipLoader from "react-spinners/ClipLoader";

export function Counter({ id }: { id: string }) {
  const counterPackageId = useNetworkVariable("counterPackageId");
  const suiClient = useSuiClient();
  const currentAccount = useCurrentAccount();
  const { mutate: signAndExecute } = useSignAndExecuteTransaction();
  const { data, isPending, error, refetch } = useSuiClientQuery("getObject", {
    id,
    options: {
      showContent: true,
      showOwner: true,
    },
  });

  const [waitingForTxn, setWaitingForTxn] = useState("");

  const executeMoveCall = (method: "increment" | "reset") => {
    setWaitingForTxn(method);

    const tx = new Transaction();

    if (method === "reset") {
      tx.moveCall({
        arguments: [tx.object(id), tx.pure.u64(0)],
        target: `${counterPackageId}::counter::set_value`,
      });
    } else {
      tx.moveCall({
        arguments: [tx.object(id)],
        target: `${counterPackageId}::counter::increment`,
      });
    }

    signAndExecute(
      {
        transaction: tx,
      },
      {
        onSuccess: (tx) => {
          suiClient.waitForTransaction({ digest: tx.digest }).then(async () => {
            await refetch();
            setWaitingForTxn("");
          });
        },
      }
    );
  };

  if (isPending) return <Text>Loading...</Text>;

  if (error) return <Text>Error: {error.message}</Text>;

  if (!data.data) return <Text>Not found</Text>;

  const ownedByCurrentAccount =
    getCounterFields(data.data)?.owner === currentAccount?.address;

  return (
    <>
      <Heading size="3">Counter {id}</Heading>

      <Flex direction="column" gap="2">
        <Text>Count: {getCounterFields(data.data)?.value}</Text>
        <Flex direction="row" gap="2">
          <Button
            onClick={() => executeMoveCall("increment")}
            disabled={waitingForTxn !== ""}
          >
            {waitingForTxn === "increment" ? (
              <ClipLoader size={20} />
            ) : (
              "Increment"
            )}
          </Button>
          {ownedByCurrentAccount ? (
            <Button
              onClick={() => executeMoveCall("reset")}
              disabled={waitingForTxn !== ""}
            >
              {waitingForTxn === "reset" ? <ClipLoader size={20} /> : "Reset"}
            </Button>
          ) : null}
        </Flex>
      </Flex>
    </>
  );
}
function getCounterFields(data: SuiObjectData) {
  if (data.content?.dataType !== "moveObject") {
    return null;
  }

  return data.content.fields as { value: number; owner: string };
}
```

### 1. `useSuiClientQuery("getObject", { id })`ë¡œ objectì˜ ë°ì´í„° ë°›ì•„ì˜¤ê¸°

- Object IDë¥¼ ì´ìš©í•´ queryë¥¼ ìˆ˜í–‰í•˜ê³ , í•´ë‹¹ Objectì˜ ë‚´ìš©(`content`)ê³¼ ì†Œìœ ì(`owner`) ë“±ì˜ ì •ë³´ë¥¼ ë°›ì•„ì˜µë‹ˆë‹¤.

### 2. `getCounterFields`ë¡œ í•„ìš”í•œ í•„ë“œ ì¶”ì¶œ

- `SuiObjectData`ë¥¼ íŒŒë¼ë¯¸í„° ê°’ìœ¼ë¡œ ë°›ìœ¼ë©°, `useSuiClientQuery`ë¡œ ê°€ì ¸ì˜¨ `data.data`ê°’ì„ ë„˜ê²¨ë°›ìŠµë‹ˆë‹¤.
- `fields`ì—ì„œ ì¹´ìš´í„° ê°’(`value`)ê³¼ ì†Œìœ ì(`owner`)ë§Œ ì¶”ì¶œí•©ë‹ˆë‹¤.

### 3. `executeMoveCall`ë¡œ íŠ¸ëœì­ì…˜ ìƒì„±, ì„œëª…ê³¼ ì‹¤í–‰

- `CreateCounter` íŒŒì¼ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ íŠ¸ëœì­ì…˜ì„ ìƒì„±í•˜ê³ , `signAndExecute`ë¡œ íŠ¸ëœì­ì…˜ ì„œëª… í›„ ì‹¤í–‰í•©ë‹ˆë‹¤.

### 5-7 routingì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

`src` í´ë”ì˜ `App.tsx` íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

```typescript
import { ConnectButton, useCurrentAccount } from "@mysten/dapp-kit";
import { isValidSuiObjectId } from "@mysten/sui/utils";
import { Box, Container, Flex, Heading } from "@radix-ui/themes";
import { useState } from "react";
import { Counter } from "./Counter";
import { CreateCounter } from "./CreateCounter";

function App() {
  const currentAccount = useCurrentAccount();
  const [counterId, setCounter] = useState(() => {
    const hash = window.location.hash.slice(1);
    return isValidSuiObjectId(hash) ? hash : null;
  });

  return (
    <>
      <Flex
        position="sticky"
        px="4"
        py="2"
        justify="between"
        style={{
          borderBottom: "1px solid var(--gray-a2)",
        }}
      >
        <Box>
          <Heading>dApp Starter Template</Heading>
        </Box>

        <Box>
          <ConnectButton />
        </Box>
      </Flex>
      <Container>
        <Container
          mt="5"
          pt="2"
          px="4"
          style={{ background: "var(--gray-a2)", minHeight: 500 }}
        >
          {currentAccount ? (
            counterId ? (
              <Counter id={counterId} />
            ) : (
              <CreateCounter
                onCreated={(id) => {
                  window.location.hash = id;
                  setCounter(id);
                }}
              />
            )
          ) : (
            <Heading>Please connect your wallet</Heading>
          )}
        </Container>
      </Container>
    </>
  );
}

export default App;
```

`OwnedObjects.tsx`ì™€ `WalletStatus.tsx` íŒŒì¼ì€ ì‚­ì œí•´ë„ ë©ë‹ˆë‹¤.

## 6ë‹¨ê³„ í”„ë¡ íŠ¸ì—”ë“œ ì‹¤í–‰

`distributed-counter/counter-dapp` ë””ë ‰í† ë¦¬ì—ì„œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

```bash
pnpm run dev
```

ì•„ë˜ urlë¡œ ì ‘ì†í•©ë‹ˆë‹¤.

```plaintext
http://localhost:5173/
```

## 7ë‹¨ê³„ Dappê³¼ ìƒí˜¸ì‘ìš©

urlì„ ì ‘ì†í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ í™”ë©´ìœ¼ë¡œ ì´ë™í•  ê²ƒì…ë‹ˆë‹¤.
![frontend main](/images/4.Distributed-Counter/Frontend_main.png)

### 7-1 ì§€ê°‘ ì—°ê²°

Dappê³¼ ìƒí˜¸ì‘ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì§€ê°‘ì„ ë¨¼ì € ì—°ê²°í•´ì•¼ í•©ë‹ˆë‹¤.
ë§Œì•½ Suiì˜ `Slush` ì§€ê°‘ì´ ì—†ë‹¤ë©´ ë¨¼ì € ì„¤ì¹˜í•´ ì£¼ì„¸ìš”.

í™”ë©´ì˜ ì˜¤ë¥¸ìª½ ìƒë‹¨ì˜ `Connect Wallet` ë²„íŠ¼ì„ ëˆ„ë¥´ê³  `Slush` ì§€ê°‘ì„ ì„ íƒí•©ë‹ˆë‹¤.

`Connection request`ë¥¼ `Approve`í•´ì¤ë‹ˆë‹¤.

![after connecting wallet](/images/4.Distributed-Counter/after_connecting_wallet.png)

ì§€ê°‘ì„ ì—°ê²°í•˜ë©´ ìœ„ì™€ ê°™ì´ `Create Counter` ë²„íŠ¼ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 7-2 Slush ì§€ê°‘ì— ê°€ìŠ¤ë¹„ ì¶©ì „

í•˜ì§€ë§Œ ì§€ê¸ˆì€ `Create Counter` ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¡œì§ì„ ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê°€ìŠ¤ë¹„ê°€ ì—†ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ì´ì œ Sui Clientì˜ ê³„ì •ì— ìˆëŠ” Sui í† í°ì„ Slush ì§€ê°‘ì˜ ê³„ì •ìœ¼ë¡œ ì˜®ê¸¸ê²ë‹ˆë‹¤.

ë¨¼ì € Sui Clientì˜ `active-address`ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. (ìƒˆë¡œìš´ í„°ë¯¸ë„ì„ ì—´ì–´ì„œ ì‹¤í–‰í•©ë‹ˆë‹¤.)

```bash
sui client active-address
```

ì´ì œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ í†µí•´ Sui í† í° Objectë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

```bash
sui client gas <YOUR_ADDRESS>
```

ì•„ë˜ì™€ ê°™ì´ `gasCoinId`(sui object id)ë¥¼ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![gas coin id](/images/4.Distributed-Counter/gas_coin_id.png)

ì´ ì¤‘ í•˜ë‚˜ì˜ `gasCoinId`ë¥¼ ì„ íƒí•´ì„œ ì˜®ê¸¸ê²ë‹ˆë‹¤.

ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ í†µí•´ Sui í† í°ì„ ì˜®ê¹ë‹ˆë‹¤. (`amounts`ì˜ ë‹¨ìœ„ëŠ” `MIST`ì…ë‹ˆë‹¤. `gasCoinId`ì˜ `mistBalance`ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.)

```bash
sui client pay-sui --recipients <YOUR_SLUSH_WALLET_ADDRESS> --input-coins <GAS_COIN_ID> --amounts <AMOUNT_IN_MIST> --gas-budget 5000000
```

> `Request rejected 429` ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ë‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜, ë°°í¬ê°€ ê³„ì† ì•ˆë  ê²½ìš° `RPC URL`ì„ ë°”ê¿”ì¤˜ì•¼ í•©ë‹ˆë‹¤.

### 7-3 Create Counter

ì´ì œ `Create Counter` ë²„íŠ¼ì„ ëˆŒëŸ¬ë´…ë‹ˆë‹¤.

`Slush` ì§€ê°‘ì„ í†µí•´ ì„œëª…ì„ ì™„ë£Œí•©ë‹ˆë‹¤.

![create counter object](/images/4.Distributed-Counter/create_counter_object.png)

ì„œëª…ì„ í•˜ë©´ ìœ„ì™€ ê°™ì´ `Counter Object`ì˜ ë°ì´í„°ì™€ `Increment`ì™€ `Reset` ë²„íŠ¼ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 7-4 Increment & Reset

`increment` ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ì„œëª…ì„ í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ `Count`ê°€ `1`ë§Œí¼ ì¦ê°€í•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[ Increment ]
![Increment](/images/4.Distributed-Counter/Increment.png)

`Reset` ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ì„œëª…ì„ í•˜ë©´ `Count`ê°€ ë‹¤ì‹œ `0`ìœ¼ë¡œ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.

[ Reset ]
![Increment](/images/4.Distributed-Counter/Reset.png)

### 7-4 Slush ì§€ê°‘ì„ ë°”ê¿” ì—°ê²°

`Slush` ì§€ê°‘ì˜ ê³„ì •ì„ í•˜ë‚˜ ë” ìƒì„±í•´ë´…ë‹ˆë‹¤.

![Add Account](/images/4.Distributed-Counter/add_account.png)

`Manage Accounts`ì—ì„œ `Add account` ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ ê³„ì •ì„ ìƒˆë¡œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Dapp í˜ì´ì§€ì—ì„œ `Disconnect` ë²„íŠ¼ì„ ëˆŒëŸ¬ ì§€ê°‘ê³¼ì˜ ì—°ê²°ì„ ëŠê³  `Connect Wallet`ìœ¼ë¡œ ìƒˆë¡œìš´ ì§€ê°‘ ê³„ì •ì„ ì—°ê²°í•©ë‹ˆë‹¤.

[Disconnect]
![Disconnect](/images/4.Distributed-Counter/Disconnect.png)

ìƒˆë¡œìš´ ê³„ì •ì„ ì—°ê²°í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ í™”ë©´ì´ ë‚˜íƒ€ë‚  ê²ƒì…ë‹ˆë‹¤.

![reconnect](/images/4.Distributed-Counter/reconnect.png)

ìš°ë¦¬ê°€ ë§Œë“  `Counter` ê°ì²´ëŠ” `Shared Object`ì´ê¸° ë•Œë¬¸ì—, ë°”ë€ ê³„ì •ìœ¼ë¡œ ì ‘ê·¼í•´ `increment` í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ `reset(set_value)` í•¨ìˆ˜ëŠ” `owner`ë§Œ í˜¸ì¶œí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ê³„ì •ì„ ë³€ê²½í•œ ë’¤ì—ëŠ” ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
